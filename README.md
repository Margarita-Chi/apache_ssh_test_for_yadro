# apache_ssh_test_for_yadro
Тестовое задание в проект “Система проверки работоспособности дистрибутивов на основе Yocto”.

Проект для автоматического тестирования веб-сервера Apache с доступом по SSH с использованием Docker-контейнеров.

## Структура проекта
apache-ssh-test/
├── agent/ # Контейнер с тестами

│ ├── Dockerfile

│ ├── requirements.txt

│ └── tests/ # Тестовые скрипты

├── target/ # Тестируемый сервер

│ ├── Dockerfile

│ ├── site/

│ └── start.sh

├── docker-compose.yml # Конфигурация контейнеров

├── run_tests_allure.sh # Запуск тестов с Allure-отчетом

├── run_tests_console.sh # Запуск тестов с консольным выводом

└── stop_tests_and_docker.sh # Остановка и очистка


## Предварительные требования

- Docker и Docker Compose
- Bash-совместимая командная оболочка
- Доступ к портам 80 (Apache) и 22 (SSH)

## Быстрый старт

1. Клонируйте репозиторий
2. Перейдите в директорию проекта:
   ```bash
   cd apache-ssh-test
   ```
3. Запустите тесты (выберите один из вариантов):

С консольным выводом:

  ```bash
  ./run_tests_console.sh
  ```

С HTML-отчетом Allure:

  ```bash
  ./run_tests_allure.sh
  ```

## Подробное описание скриптов

### **run_tests_console.sh**

Запускает тесты с подробным выводом результатов в консоль.

- Проверяет запущен ли контейнер с Apache

- Запускает тесты в контейнере agent

- Выводит результаты в реальном времени

- Сохраняет логи в ./logs/run.log

### **run_tests_allure.sh**

Запускает тесты с генерацией интерактивного HTML-отчета.

- Проверяет и запускает тестовый сервер

- Выполняет тесты и собирает данные для отчета

- Генерирует Allure-отчет

- Запускает веб-сервер для просмотра отчета

- Автоматически определяет свободный порт для отчета

После выполнения этого скрипта зайдите в браузер по адресу, который выдаст программа http://localhost:host_port/

### **stop_tests_and_docker.sh**
Полная остановка и очистка системы.

- Останавливает все контейнеры

- Удаляет временные файлы и логи

- Очищает Allure-отчеты

- Восстанавливает права доступа к файлам

## Настройка переменных окружения
Вы можете настроить параметры тестирования через переменные окружения в docker-compose.yml:

```yaml
environment:
  LOG_CHECK_MINUTES: 5          # Период проверки логов (минуты)
  EXPECTED_INDEX_TEXT: "Hello from Apache"  # Ожидаемый текст на главной странице
  EXPECTED_404_TEXT: "Not Found"            # Текст страницы 404 ошибки
  TARGET_HOST: target           # Хост целевого сервера
  SSH_USER: tester              # Пользователь SSH
  SSH_PASSWORD: testerpass      # Пароль SSH
  SSH_PORT: 22                  # Порт SSH
```

## Доступные тесты

test_apache_service_active.py - Проверка активности службы Apache

test_index_page.py - Проверка главной страницы

test_apache_404.py - Тестирование обработки 404 ошибок

test_apache_logs_last_N_min.py - Анализ логов за указанное количество минут 

test_smoke_packages.py - Проверка работоспособности пакетов ln, tar

## Ручной запуск тестов
Для запуска без скриптов используйте команду:

```bash
docker compose run --rm agent pytest tests/ -v
```

## Ожидаемый результат
При успешном выполнении всех тестов вы увидите:

``` text
=== Running tests (console mode) ===
collected 6 items

tests/test_apache_404.py::test_apache_404_exists PASSED
tests/test_apache_logs_last_N_min.py::test_apache_logs_exist PASSED
...

=== Tests completed ===
6 passed, 0 failed in X.XXs
```

## Решение проблем
### Нет прав на выполнение скриптов:

```bash
chmod +x *.sh
```

### Заняты порты 80 или 22:

- Остановите локальные веб-серверы

- Измените порты в docker-compose.yml

## Дополнительная информация

Логи тестирования сохраняются в директорию logs/

Allure-отчеты доступны в allure-report/

Сырые результаты тестов - в allure-results/

# Формулировка изначального задания

## Основные требования

Необходимо написать набор тестов языке Python, которые будут проверять корректность работы приложения

target - докер-контейнер, в котором запущен веб-сервер Apache2, демонстрирующий статическую веб-страницу ( /index)

Тесты (agent) докер-контейнер, подключаются к target (по ssh) и проверяют:

- запущен ли веб-сервер

- есть ли в логах веб-сервера ошибки за последние Н минут (Н - задается в параметрах docker-compose)

- корректно ли веб-сервер показывает /index, а также как он выдает ошибки на несуществующие страницы

Python 3.10+

Результаты запуска тестов должны быть структурированы в виде отчета и выведены в консоль. 

Тесты должны быть реализованы с помощью известных test-фреймворков (предпочтение pytest).

Запуск системы должен быть реализован в Docker окружении с использованием docker-compose

target и agent - отдельные контейнеры

Для управления образами и контейнерами необходимо использовать docker-compose

Базовый образ: debian:bookworm-slim

Использование docker-compose второй версии

Подробная инструкция по сборке и запуску проекта

Описание необходимых зависимостей

Примеры команд для сборки проекта

Примеры команд запуска и ожидаемый результат

Задание необходимо оформить в виде репозитория с исходным кодом: код тестов, dockerfile и docker-compose файл, скрипты для запуска и сборки


## Дополнительные требования:

Реализация смок-тестов для проверки работоспособности штатных пакетов - tar, ln (не только проверить наличие, но и работоспособность)

Возможность кастомизации credentials для подключения к target

Возможность запуска с подключением к внешнему target

Использование фреймворка Allure https://allurereport.org/
